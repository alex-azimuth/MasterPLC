{"CLs":[{"__type":"IST","EID":"fefaeab2-b843-4144-8f53-292299d6f894","H":1847,"TXT":"\/\/ Setup rising edge\u000d\u000aAuto_Top_Stop_Toggle_R(CLK:=HMI_C_Press_Calibration_Data.Auto_Top_Stop_Toggle);\u000d\u000aCalibrate_High_Toggle_R(CLK:=HMI_C_Press_Calibration_Data.Calibrate_High_Toggle);\u000d\u000aCalibrate_Low_Toggle_R(CLK:=HMI_C_Press_Calibration_Data.Calibrate_Low_Toggle);\u000d\u000aCalibrate_Cam_R(CLK:=Calibrate_Cam.In_Zone);\u000d\u000aPress_Idle_TON(IN:=Press_Idle, PT:=T#250ms);\u000d\u000a\u000d\u000a\/\/ Operating mode change\u000d\u000aIF (Auto_Top_Stop_Toggle_R.Q) THEN\u000d\u000a\u0009C_Press_Calibration_Data.Auto_Top_Stop := NOT C_Press_Calibration_Data.Auto_Top_Stop;\u000d\u000aEND_IF;\u000d\u000aHMI_C_Press_Calibration_Data.Auto_Top_Stop_State := C_Press_Calibration_Data.Auto_Top_Stop;\u000d\u000a\u000d\u000a\/\/  Prevent automatic top stop entirely if ethercat option is not enabled\u000d\u000aIF (NOT Master_Press_Options.ABB_ECAT) THEN\u000d\u000a\u0009C_Press_Calibration_Data.Auto_Top_Stop := FALSE;\u000d\u000aEND_IF;\u000d\u000a\u000d\u000a\/\/ Calibration toggle\u000d\u000aIF (Calibrate_High_Toggle_R.Q) THEN\u000d\u000a\u0009HMI_C_Press_Calibration_Data.Calibrate_High_State := NOT HMI_C_Press_Calibration_Data.Calibrate_High_State;\u000d\u000aEND_IF;\u000d\u000aIF (Calibrate_Low_Toggle_R.Q) THEN\u000d\u000a\u0009HMI_C_Press_Calibration_Data.Calibrate_Low_State := NOT HMI_C_Press_Calibration_Data.Calibrate_Low_State;\u000d\u000aEND_IF;\u000d\u000a\u000d\u000aCalibrate_Cam(Enable := TRUE,\u000d\u000a\u0009\u0009\u0009  Pos := Press.Pos,\u000d\u000a\u0009\u0009\u0009  Angle2 := HMI_C_Press_Calibration_Data.Auto_Stop_Angle,\u000d\u000a\u0009\u0009\u0009  Angle1 := HMI_C_Press_Calibration_Data.Auto_Stop_Angle-C_Press_Calibration_Data.Angle_Range);\u000d\u000a\u000d\u000a\/\/ Record values when the press is moving\u000d\u000aIF (NOT Press_Idle) AND (Calibrate_Cam_R.Q) THEN\u000d\u000a\u0009IF (HMI_C_Press_Calibration_Data.Calibrate_High_State) THEN\u000d\u000a\u0009\u0009C_Press_Calibration_Data.SPM_AT_MAX_HZ := (Press.Speed);\u000d\u000a\u0009END_IF;\u000d\u000a\u0009IF (HMI_C_Press_Calibration_Data.Calibrate_Low_State) THEN\u000d\u000a\u0009\u0009C_Press_Calibration_Data.SPM_AT_MIN_HZ := (Press.Speed);\u000d\u000a\u0009END_IF;\u000d\u000a\u0009Wait_For_Stop_Flag := TRUE;\u000d\u000aEND_IF;\u000d\u000a\u000d\u000a\/\/ Record brake time once the press is stopped\u000d\u000aIF (Press_Idle_TON.Q AND Wait_For_Stop_Flag) THEN\u000d\u000a\u0009IF (HMI_C_Press_Calibration_Data.Calibrate_Low_State) THEN\u000d\u000a\u0009\u0009\u0009\/\/ Store brake time\u000d\u000a\u0009\u0009\u0009C_Press_Calibration_Data.BRAKE_T_MIN_SPM := LINT_TO_LREAL(HMI_Press_Data.Act_Brake_Time);\u000d\u000a\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\/\/ Calculate Top Stop angle based on brake time\u000d\u000a\u0009\u0009\u0009T_Stop_Calc_LOW(Enable:=TRUE,\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009\u0009SPM:=C_Press_Calibration_Data.SPM_AT_MIN_HZ,\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009\u0009Brake_T:=C_Press_Calibration_Data.BRAKE_T_MIN_SPM);\u000d\u000a\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\/\/ Store top stop angle\u000d\u000a\u0009\u0009\u0009IF (T_Stop_Calc_LOW.T_Angle > 200) THEN\u000d\u000a\u0009\u0009\u0009\u0009C_Press_Calibration_Data.ANGLE_T_STOP_MIN_SPM := T_Stop_Calc_LOW.T_Angle;\u000d\u000a\u0009\u0009\u0009ELSE\u000d\u000a\u0009\u0009\u0009\u0009LOW_T_Error := TRUE;\u000d\u000a\u0009\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\/\/ Store low speed\u000d\u000a\u0009\u0009\u0009C_Press_Calibration_Data.MIN_HZ := HMI_C_Press_Calibration_Data.Calibration_Speed;\u000d\u000a\u0009END_IF;\u000d\u000a\u0009IF (HMI_C_Press_Calibration_Data.Calibrate_High_State) THEN\u000d\u000a\u0009\u0009\u0009\/\/ Store brake time\u000d\u000a\u0009\u0009\u0009C_Press_Calibration_Data.BRAKE_T_MAX_SPM := LINT_TO_LREAL(HMI_Press_Data.Act_Brake_Time);\u000d\u000a\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\/\/ Calculate Top Stop angle based on brake time\u000d\u000a\u0009\u0009\u0009T_Stop_Calc_High(Enable:=TRUE,\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009\u0009SPM:=C_Press_Calibration_Data.SPM_AT_MAX_HZ,\u000d\u000a\u0009\u0009\u0009\u0009\u0009\u0009\u0009Brake_T:=C_Press_Calibration_Data.BRAKE_T_MAX_SPM);\u000d\u000a\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\/\/ Store top stop angle\u000d\u000a\u0009\u0009\u0009IF (T_Stop_Calc_High.T_Angle > 200) THEN\u000d\u000a\u0009\u0009\u0009\u0009C_Press_Calibration_Data.ANGLE_T_STOP_MAX_SPM := T_Stop_Calc_High.T_Angle;\u000d\u000a\u0009\u0009\u0009ELSE\u000d\u000a\u0009\u0009\u0009\u0009High_T_Error := TRUE;\u000d\u000a\u0009\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u0009\u000d\u000a\u0009\u0009\u0009\/\/ Store High speed\u000d\u000a\u0009\u0009\u0009C_Press_Calibration_Data.MAX_HZ := HMI_C_Press_Calibration_Data.Calibration_Speed;\u000d\u000a\u0009END_IF;\u000d\u000a\u0009Wait_For_Stop_Flag := FALSE;\u000d\u000aEND_IF;\u000d\u000a\u000d\u000aHMI_C_Press_Calibration_Data.Calibration_Alarm := High_T_Error OR LOW_T_Error;\u000d\u000a\u000d\u000aHMI_C_Press_Calibration_Data.ANGLE_T_STOP_MAX_SPM:= LREAL_TO_REAL(C_Press_Calibration_Data.ANGLE_T_STOP_MAX_SPM);\u000d\u000aHMI_C_Press_Calibration_Data.ANGLE_T_STOP_MIN_SPM:= LREAL_TO_REAL(C_Press_Calibration_Data.ANGLE_T_STOP_MIN_SPM);\u000d\u000aHMI_C_Press_Calibration_Data.SPM_AT_MAX_HZ := LREAL_TO_REAL(C_Press_Calibration_Data.SPM_AT_MAX_HZ);\u000d\u000aHMI_C_Press_Calibration_Data.SPM_AT_MIN_HZ := LREAL_TO_REAL(C_Press_Calibration_Data.SPM_AT_MIN_HZ);\u000d\u000a\u000d\u000a","W":1250}],"LRI":1,"RRI":2,"VLs":[]}
